<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Area Barber - Gestione Appuntamenti</title>
    <link rel="stylesheet" href="Static/Css/style.css">
</head>
<body>
    <header>
        <h1>Gestione Appuntamenti üíº</h1>
    </header>

    <main>
        <div id="loginArea">
            <h3>Accesso Barbiere</h3>
            <input type="password" id="password" placeholder="Inserisci password">
            <button id="loginBtn">Entra</button>
            <p id="loginMessaggio"></p>
        </div>

        <div id="adminArea" style="display:none;">
            <h2>Appuntamenti Prenotati</h2>
            <table id="tabella">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Servizio</th>
                        <th>Data</th>
                        <th>Ora</th>
                        <th>Azioni</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div class="admin-controls">
                <button id="svuota">üóëÔ∏è Cancella tutti</button>
                <a href="index.html">Vai alla pagina pubblica</a>
            </div>
        </div>
    </main>

    <script>
        // admin.js
const loginBtn = document.querySelector('#loginBtn');
const passwordInput = document.querySelector('#password');
const loginMessaggio = document.querySelector('#loginMessaggio');
const adminArea = document.querySelector('#adminArea');
const loginArea = document.querySelector('#loginArea');
const tabellaBody = document.querySelector('#tabella tbody');
const svuotaBtn = document.querySelector('#svuota');

// Password esempio (attenzione: solo per uso locale/demo)
const PASSWORD = "barbiere123";

loginBtn.addEventListener('click', () => {
    if (passwordInput.value === PASSWORD) {
        loginArea.style.display = 'none';
        adminArea.style.display = 'block';
        mostraPrenotazioni();
    } else {
        loginMessaggio.textContent = "‚ùå Password errata";
        loginMessaggio.style.color = "salmon";
    }
});

function mostraPrenotazioni() {
    let prenotazioni = JSON.parse(localStorage.getItem('prenotazioni')) || [];
    tabellaBody.innerHTML = "";

    if (prenotazioni.length === 0) {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td colspan="5" style="text-align:center; padding:20px;">Nessuna prenotazione</td>`;
        tabellaBody.appendChild(tr);
        return;
    }

    prenotazioni.forEach(p => {
        const tr = document.createElement('tr');

        // riga con bottone elimina singolo
        tr.innerHTML = `
            <td>${escapeHtml(p.nome)}</td>
            <td>${escapeHtml(p.servizio)}</td>
            <td>${escapeHtml(p.data)}</td>
            <td>${escapeHtml(p.ora)}</td>
            <td><button class="elimina" data-id="${p.id}">Elimina</button></td>
        `;
        tabellaBody.appendChild(tr);
    });

    // aggiungo listener per eliminare singoli
    document.querySelectorAll('.elimina').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const id = Number(btn.dataset.id);
            eliminaPrenotazione(id);
        });
    });
}

function eliminaPrenotazione(id) {
    let prenotazioni = JSON.parse(localStorage.getItem('prenotazioni')) || [];
    prenotazioni = prenotazioni.filter(p => p.id !== id);
    localStorage.setItem('prenotazioni', JSON.stringify(prenotazioni));
    mostraPrenotazioni();
}

svuotaBtn.addEventListener('click', () => {
    if (confirm("Vuoi davvero cancellare tutte le prenotazioni?")) {
        localStorage.removeItem('prenotazioni');
        mostraPrenotazioni();
    }
});

// semplice funzione per evitare inserimenti HTML pericolosi
function escapeHtml(text) {
    if (!text && text !== 0) return '';
    return String(text)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
}

    </script>
</body>
</html>
